# Network - 스위치의 기본 기능 및 VLAN, L2 구간 루핑 예방 알고리즘
## L2 Switch

**네트워크에서 통신을 중재하는 2계층 대표 장비, 스위치**

- 1계층 장비인 허브의 문제점인 충돌과 브로드 캐스트 트래픽으로 인한 성능 저하를 해소하는 장비
- MAC 테이블을 기반으로 전달받은 패킷을 정확한 목적지로 포워딩
- 물리적으로 동일한 네트워크 구간에 위치한 엔드 디바이스들을 논리적으로 다른 네트워크 구간에 있는 것처럼 네트워크를 나누어주는 VLAN 기능을 가짐
- 동일 네트워크 구간에서 네트워크 루핑을 예방
- 보안 및 모니터링 기능

<br>

**패킷을 전달하기 위한 스위치의 5가지 동작 방식**

1. Flooding - MAC 테이블에 학습된 정보가 없을 경우, 허브와 같이 모든 포트로 패킷 포워딩
2. Address Learning - 패킷의 출발지 MAC 주소를 학습해 MAC 테이블에 적재 (정적 / 동적)
3. Forwarding - MAC 테이블에 학습된 정보가 있을 경우 포워딩
4. Filtering - 패킷을 포워딩할 때, 다른 포트로 트래픽이 흐르지 않도록 차단
5. Ageing - MAC 테이블에 적재된 정보 폐기 시간

⇒ ARP 프로토콜을 이용해 미리 정보를 학습하기에 패킷 플루딩 현상이 발생하는 경우는 드물다. 만일, 지속적으로 플루딩 현상이 발생하는 경우, 보안적인 이슈가 있는지 확인이 필요하다.

<br>

**VLAN**

- 물리적으로 동일한 네트워크 대역에 위치한 엔드 디바이스들을 논리적으로 다른 네트워크 구간에 있는 것처럼 네트워크를 나누어주는 기술
- 포트 기반 VLAN 과 MAC 기반 VLAN 으로 나누어진다.
- 포트 기반 VLAN은, 고정적인 포트를 기준으로 VLAN을 구성하며, MAC 기반 VLAN은 고정적인 포트가 아닌 MAC 주소로 VLAN을 할당한다.

<br>

**VLAN 구성시 장점**

- 브로드캐스트 트래픽으로 인한 성능 저하 해소
- 보안성 향상 및 VLAN 별로 효과적인 정책 적용
- 스위치를 여러대 구성할 필요 없이, 한 대의 장비를 이용해 논리적으로 다른 네트워크에 있는 것처럼 구성 가능하여 비용 절감

<br>

**VLAN 구성시 서로 다른 VLAN 과의 통신 방식 (Trunk / Access)**

- 언태그 통신시 3계층 장비를 이용해 통신하는 방법
- VLAN 태그를 이용해 하나의 포트에 여러개의 VLAN을 전송하는 방법 (Tag Port, Trunk - VLAN ID)

<br>

**네트워크 단일 지점 장애(SPoF)**

- 네트워크 장비에서 장애가 발생하는 것을 예방하여 이중화 혹은 다중화 구성
- 장애를 예방하기 위해 다중화 디자인 ⇒ 네트워크 루핑 발생

<br>

**네트워크 루프 발생 원인**

- 브로드 캐스트 스톰 → 지속적으로 스위치들끼리 플루딩을 하는 현상
- 스위치 MAC 주소 중복 문제 → 여러 스위치 포트의 동일한 MAC 주소 학습
- 3계층 장비와는 다르게, 2계층 장비에는 헤더에 TTL이 없기에 패킷이 폐기되지 못한다.

<br>

**네트워크 루프 정적 예방 (권장되지 않는 방법)**

- 정적으로 네트워크 루핑을 방지하는 방법은 장애에 적절히 대처하지 못하기 때문에 권장되지 않는다.
- 경고 메세지 안내 방법
- 플래팅 현상 자동 조치
- 임의로 포트 셧다운

<br>

**네트워크 루프 예방, STP 메커니즘**

- 스패닝 트리 프로토콜을 이용해 루프를 확인하여 적절히 포트를 차단하는 기술 (루프 예방 메커니즘)
- BPDU 메세지를 주고 받으며, 스위치간 정보를 전달해 루프 구간 확인 ⇒ 루트 브릿지에게 보고하고 전파되는 형식 (전체 네트워크 트리)
- BPDU 를 통해 트래픽 차단 및 허용 결정
- 단점으로는, BPDU 정보를 주고 받기 위한 시간(Blooking 상태에서 Flooding 상태까지)이 약 30초에서 50초가 소요되기 때문에 TCP 통신시 영향이 발생하며, VLAN 구성시 STP 알고리즘을 계산하면서 부하가 발생하기도 한다.

<br>

**STP 문제점을 개선한 RSTP 이란?**

- RSTP 메커니즘은 STP 문제점을 개선한 방식으로, 약 30초~50초가 소요되었던 시간을 2~3초 이내로 처리할 수 있도록 하였다.
- 8개의 비트를 활용해 다양한 메세지 형식을 주고 받는다.
- 기존 STP의 루트 브릿지에게 보고하는 방식이 아닌, 터미널 스위치가 토폴로지 변화를 다른 브릿지에게 알리는 방식

<br>

**VLAN 구성시 루핑을 방지하는 방법, MST**

- VLAN 마다 스패닝 트리를 유지하는 방법으로, 여러 개의 VLAN 을 그룹별로 묶어 스패닝 트리가 동작하도록 하는 방식이다.
